<Window x:Class="TextSeeker.MainWindow"
         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
         xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
         xmlns:src="clr-namespace:TextSeeker"
         xmlns:helpers="clr-namespace:TextSeeker.Helpers"
         xmlns:webView="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
         Background="WhiteSmoke"
         FlowDirection="RightToLeft"
         Height="450" Width="800"        
        FocusManager.FocusedElement="{Binding ElementName=SearchTextBox}"
        Closing="Window_Closing">
    <Grid Margin="5,5,5,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="5" />
            <RowDefinition Height="*" />
            <RowDefinition Height="5" />
            <RowDefinition Height="*" />
            <RowDefinition Height="5" />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="auto" />
            <ColumnDefinition Width="5" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <Grid x:Name="SearchPanel" Grid.ColumnSpan="3" Grid.Row="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="5"/>
                <RowDefinition Height="auto"/>
            </Grid.RowDefinitions>

            <TextBox x:Name="SearchTextBox" 
                     Background="White" BorderBrush="LightGray"
                     Text="{Binding SearchTerm, Mode=TwoWay, BindsDirectlyToSource=True, UpdateSourceTrigger=PropertyChanged}"
                     KeyDown="SearchTextBox_KeyDown"
                      IsEnabled="{Binding IsEnabled}"/>
            <Button x:Name="SearchButton" Content="{Binding SearchButtonText}" Margin="3,0,3,0.5" 
                Background="{x:Null}" BorderThickness="0" 
                    Grid.Row="0" HorizontalAlignment="Right"
                    Click="SearchButton_Click"
                     IsEnabled="{Binding IsEnabled}"/>

            <ProgressBar x:Name="SearchProgressBar" Grid.Row="1" 
                         Background="{x:Null}" BorderThickness="0" Height="3"
                         IsIndeterminate="{Binding IsSearchInProgress}"/>

            <!--<StackPanel Orientation="Horizontal" Grid.Row="2">
                <ComboBox x:Name="SearchMethodsComboBox" MinWidth="100"/>
                <CheckBox x:Name="SearchFileNamesCheckBox" Content="חפש גם בשמות הקבצים" VerticalAlignment="Center" 
                      Margin="5,0,0,2"/>
            </StackPanel>-->
        </Grid>

        <Border Grid.Column="0" Grid.Row="2" Grid.RowSpan="3"
                BorderBrush="LightGray" BorderThickness="1">
        <Grid >
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.Resources>
                <Style TargetType="Button">
                    <Setter Property="Height" Value="25"/>
                    <Setter Property="Background" Value="{x:Null}"/>
                    <Setter Property="BorderThickness" Value="0"/>
                </Style>
            </Grid.Resources>

                <StackPanel Orientation="Horizontal" Grid.Row="0" >
                <Button x:Name="AddTreeItemButton" ToolTip="הוסף מיקומים לחיפוש" 
                        Click="AddTreeItemButton_Click">
                    <Image Source="/Resources/AddItem.png" />
                </Button>
                
                <Button x:Name="DeleteTreeItemButton" ToolTip="מחק את המיקום המסומן" 
                        Click="DeleteTreeItemButton_Click">
                    <Image Source="/Resources/DeleteItem.png" />
                </Button>
                
                <!--<Button x:Name="AboutButton" ToolTip="אודות">
                    <Border  BorderBrush="Black" BorderThickness="2" Margin="3"  Width="18">
                        <TextBlock Text="!" FontWeight="Bold"
                               TextAlignment="Center" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                </Button>-->
            </StackPanel>
            
            <TreeView Name="DirectoryTreeView" Grid.Row="1" 
                      BorderBrush="LightGray"  BorderThickness="0"
                      ItemsSource="{Binding RootTreeViewNode.Children, Mode=TwoWay}">
                <TreeView.Resources>
                        <Style TargetType="TreeViewItem">
                            <EventSetter Event="PreviewMouseDoubleClick" Handler="FileItem_MouseDoubleClick"/>
                            <EventSetter Event="PreviewKeyDown" Handler="FileItem_KeyDown"/>
                            <Setter Property="Tag" Value="{Binding}"/>
                        </Style>
                    <HierarchicalDataTemplate DataType="{x:Type src:FolderTreeNode}" ItemsSource="{Binding Children, Mode=TwoWay}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="📁" FontSize="14" LineStackingStrategy="BlockLineHeight" LineHeight="15"/>
                            <CheckBox IsChecked="{Binding IsChecked, Mode=TwoWay}" Margin="5,0,5,0" />
                            <TextBlock Text="{Binding Name}"/>
                        </StackPanel>
                    </HierarchicalDataTemplate>
                    <DataTemplate DataType="{x:Type src:FileTreeNode}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="🗎"  FontSize="16" LineStackingStrategy="BlockLineHeight" LineHeight="17"/>
                            <CheckBox IsChecked="{Binding IsChecked, Mode=TwoWay}" Margin="5,0,5,0" />
                            <TextBlock Text="{Binding Name}"/>
                        </StackPanel>
                    </DataTemplate>
                </TreeView.Resources>
            </TreeView>
        </Grid>
        </Border>

        <!--<TextBox x:Name="StatusTextBlock" Grid.Column="0" Grid.Row="4" BorderBrush="LightGray" Background="White"
             IsReadOnly="True"/>-->

        <GridSplitter Grid.Column="1" Grid.Row="2" Grid.RowSpan="3" VerticalAlignment="Stretch" HorizontalAlignment="Stretch"/>
        <GridSplitter Grid.Row="3" Grid.Column="2"  VerticalAlignment="Stretch" HorizontalAlignment="Stretch"/>
     
        <DataGrid x:Name="SearchResultsDataGrid" Grid.Column="2" Grid.Row="2"
                  BorderBrush="LightGray" Background="White"
                  ItemsSource="{Binding SearchResults}"
                  HorizontalGridLinesBrush ="{x:Null}"
                  VerticalGridLinesBrush="WhiteSmoke"
                  CanUserResizeRows="False"
                  IsReadOnly="True"
                  FlowDirection="LeftToRight"
                  AutoGenerateColumns="False"
                  SelectionChanged="SearchResultsDataGrid_SelectionChanged">
            <DataGrid.Resources>
                <Style TargetType="DataGridCell">
                    <EventSetter Event="MouseDoubleClick" Handler="FileItem_MouseDoubleClick"/>
                    <EventSetter Event="PreviewKeyDown" Handler="FileItem_KeyDown"/>
                    <Setter Property="Tag" Value="{Binding}"/>
                </Style>
                <Style TargetType="DataGridRowHeader">
                    <Setter Property="Background" Value="{x:Null}"/>
                </Style>
            </DataGrid.Resources>
            <DataGrid.Columns>
                <DataGridTextColumn Binding="{Binding Name}"/>
                <DataGridTextColumn Binding="{Binding Directory}"/>
                <DataGridTextColumn Binding="{Binding DateLastModified}"/>
            </DataGrid.Columns>
        </DataGrid>

        <Border Background="White" BorderBrush="LightGray" BorderThickness="1"
                Grid.Column="3" Grid.Row="4">
            <Grid>
                <TextBlock Text="תצוגה מקדימה" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="LightGray"/>
                <webView:WebView2 Name="PreviewBrowser"/>
            </Grid>
        </Border>

        <StatusBar Grid.Row="6" Grid.ColumnSpan="3" Height="10">
            <StatusBarItem>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
